{"version":3,"file":"iframe-broker.bundle.js","mappings":";;;;;;;;;;AAAa,6IAA6I,EAAE,cAAc,4BAA4B,yBAAyB,wBAAwB,EAAE,8CAA8C,EAAE,QAAQ,qBAAqB,uBAAuB,eAAe,wGAAwG,uGAAuG,wCAAwC,iBAAiB,aAAa,GAAG,GAAG,iBAAiB,+BAA+B,gBAAgB,iDAAiD,WAAW,gBAAgB,oGAAoG,oBAAoB,qDAAqD,WAAW,cAAc,wCAAwC,cAAc,2CAA2C,0BAA0B,qDAAqD,qCAAqC,IAAI,gDAAgD,kBAAkB,aAAa,iCAAiC,oCAAoC,IAAI,2BAA2B,SAAS,UAAU,+BAA+B,QAAQ,mBAAmB,uMAAuM,2BAA2B,2BAA2B,4BAA4B,wCAAwC,kEAAkE,mBAAmB,SAAS,SAAS,2CAA2C,GAAG,wHAAwH,qCAAqC,mIAAmI,iDAAiD,oBAAoB,SAAS,sBAAsB,GAAG,2BAA2B,iFAAiF,QAAQ,mBAAmB,IAAI,gBAAgB,SAAS,UAAU,+CAA+C,yBAAyB,sKAAsK,gCAAgC,MAAM,yKAAyK,0DAA0D,4EAA4E,SAAS,gIAAgI,UAAU,GAAG,MAAM,OAAO,oCAAoC,YAAY,uDAAuD,iBAAiB,uBAAuB,EAAE,uCAAuC,SAAS,2BAA2B,SAAS,8CAA8C,EAAE,KAAK,2BAA2B,iKAAiK,UAAU,cAAc,SAAS,+DAA+D,iCAAiC,YAAY,WAAW,IAAI,MAAM,kBAAkB,GAAG,uDAAuD,aAAa,sDAAsD,8CAA8C,sBAAsB,4FAA4F,iBAAiB,GAAG,KAAK,SAAS,UAAU,6BAA6B,mDAAmD,iBAAiB,YAAY,2BAA2B,OAAO,GAAG,OAAO,OAAO,8CAA8C,kCAAkC,sEAAsE,0CAA0C,GAAG,SAAS,+BAA+B,aAAa,sDAAsD,qBAAqB,yDAAyD,SAAS,6CAA6C,kBAAkB,yBAAyB,4BAA4B,GAAG,SAAS,wEAAwE,UAAU,GAAG,GAAG,iBAAiB,oBAAoB,CAAC,yBAAyB;;;;;;;;;;;;;;;ACEl7J;;;GAGG;AACI,KAAK,UAAU,WAAW;IAChC,OAAO;QACN,QAAQ,EAAE;YACT,eAAe,EAAE,kDAAkD;YACnE,SAAS,EAAE,mDAAmD;YAC9D,UAAU,EAAE,mBAAmB;YAC/B,mBAAmB,EAAE,OAAO;SAC5B;KACD,CAAC;AACH,CAAC;;;;;;;UCfD;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;ACNkF;AACzC;AAEzC;;;GAGG;AACH,KAAK,UAAU,IAAI;IAClB,MAAM,QAAQ,GAAG,MAAM,sDAAW,EAAE,CAAC;IACrC,OAAO,wEAAoB,CAAC;QAC3B,eAAe,EAAE,QAAQ,CAAC,QAAQ,CAAC,eAAe;QAClD,YAAY,EAAE;YACb,QAAQ,EAAE,WAAW;SACrB;KACD,CAAC,CAAC;AACJ,CAAC;AAED,IAAI,EAAE;KACJ,IAAI,CAAC,GAAG,EAAE;IACV,OAAO,CAAC,GAAG,CAAC,6CAA6C,CAAC,CAAC;IAC3D,OAAO,IAAI,CAAC;AACb,CAAC,CAAC;KACD,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC","sources":["webpack://openfin-web--web-interop-basic/../../node_modules/@openfin/web-interop/out/iframe-broker.js","webpack://openfin-web--web-interop-basic/./client/src/platform/settings.ts","webpack://openfin-web--web-interop-basic/webpack/bootstrap","webpack://openfin-web--web-interop-basic/webpack/runtime/define property getters","webpack://openfin-web--web-interop-basic/webpack/runtime/hasOwnProperty shorthand","webpack://openfin-web--web-interop-basic/webpack/runtime/make namespace object","webpack://openfin-web--web-interop-basic/./client/src/platform/iframe-broker.ts"],"sourcesContent":["\"use strict\";const e=\"web-broker-ports-ready\",t=\"worker-initialize-connection\",r=\"create-fallback-connection\",i=\"request-fallback-connection\",o=e=>`ack-${e}`,n=(...e)=>({log:(...t)=>console.log(`[${(new Date).toISOString()}]`,...(e=>e.map((e=>`[${e}]`)))(e),...t),getLogger:(...t)=>n(...e,...t)});class s{static get lockApi(){return navigator.locks}constructor(e){this.name=e,this.releaseCallback=null,s.pending.add(this),this.lockAcquiredPromise=new Promise(((e,t)=>{this.lockReleasedPromise=s.lockApi.request(this.name,(()=>(s.pending.delete(this),e(),new Promise((e=>{s.held.add(this),this.releaseCallback=e}))))).catch((e=>{throw t(e),e}))}))}async acquired(){await this.lockAcquiredPromise}async release(){if(!this.releaseCallback)throw new Error(`Lock ${this.name} not acquired.`);this.releaseCallback(),this.releaseCallback=null,await this.lockReleasedPromise,s.held.delete(this)}async onReleased(e){if(!this.lockReleasedPromise)throw new Error(`Lock ${this.name} not queued.`);return this.lockReleasedPromise.then(e)}autoRelease(){this.acquired().then((()=>this.release()))}static async releaseAll(){const e=Promise.all([...this.pending].map((async e=>{await e.acquired(),await e.release()})));await Promise.all([...this.held].map((async e=>{await e.release()}))),await e}}s.pending=new Set,s.held=new Set;const a=e=>window.top===e,c=(e,t)=>{try{return e.origin===t.origin}catch(e){return!1}},d=\"openfin/web-shared-worker\";class h{constructor(e,t,n){this.workerUrl=e,this.iframeWindow=t,this.forceWorker=n,this.isSharedWorkerSupported=()=>!this.forceWorker&&!!window.SharedWorker,this.state=\"ready\",this.establishWorkerConnectionViaWindow=async e=>{if(c(this.iframeWindow,e)){const t=new MessageChannel;return new Promise(((n,s)=>{t.port1.addEventListener(\"message\",(e=>{e.data.topic===o(r)&&(e.data.success?n(t.port1):s(e.data.reason))})),t.port1.start();const a={topic:i};e.postMessage(a,location.origin,[t.port2])}))}throw new Error(\"Could not connect via top level browsing context as its origin does not much the web interop broker.\")},this.listenForNestedConnections=e=>{\"top-window\"===this.state&&c(this.iframeWindow,this.iframeWindow.parent)&&this.iframeWindow.parent.addEventListener(\"message\",(t=>{if(t.origin===location.origin&&t.data.topic===i){const[i]=t.ports,o={topic:r};e.postMessage(o,[i])}}))},this.initialize=async()=>{if(\"ready\"!==this.state)throw new Error(\"Worker connection already initialized\");if((e=>{const t=r=>!(!(e=>{try{return!e.origin}catch(e){return!0}})(r)&&r.origin===e.origin)||!a(r)&&t(r.parent);return!a(e)&&t(e.parent)})(this.iframeWindow)&&c(this.iframeWindow,this.iframeWindow.top))return this.state=\"partitioned-frame\",this.establishWorkerConnectionViaWindow(this.iframeWindow.top);if(a(this.iframeWindow.parent)){let e;return this.state=\"top-window\",e=this.isSharedWorkerSupported()?new SharedWorker(this.workerUrl,d).port:new Worker(this.workerUrl),this.listenForNestedConnections(e),e}{if(this.state=\"frame\",!this.isSharedWorkerSupported())try{return await this.establishWorkerConnectionViaWindow(this.iframeWindow.top)}catch(e){throw new Error(`SharedWorker is not supported and an unexpected error occured when trying to connect via fallback mechanism: ${e.message}`)}const{port:e}=new SharedWorker(this.workerUrl,d);return e}}}}const l=n(\"@openfin/web-interop/iframe-broker\"),w=()=>{const e=((e,t)=>{const r=new RegExp(`^${t}<(?<meta>.*)>$`).exec(e)?.groups?.meta;if(r)try{return JSON.parse(atob(r))}catch(e){throw new Error(`Failed to decode JSON from ${r}.`)}})(window.name,\"of-broker\");if(!e)throw new Error(\"Invalid or missing identity string in iframe context. Ensure that this iframe is being renderered via the @openfin/web-interop library.\");return e};function p(t){const r={topic:o(e),success:!1,reason:t?.reason??\"Connection Rejected\"};window.parent.postMessage(r,\"*\")}exports.init=async r=>{try{const{sharedWorkerUrl:i}=r;await(\"loading\"===document.readyState?new Promise((e=>{const t=()=>{e(),window.removeEventListener(\"DOMContentLoaded\",t)};window.addEventListener(\"DOMContentLoaded\",t)})):Promise.resolve());const n=w(),a=new h(i,window,\"same-site\"!==r.experimental?.crossTab),c=await a.initialize();l.log(`Loading ${i} in ${a.state} mode...`);const d=await(async(r,i,n)=>{const a=new MessageChannel,c=new MessageChannel,d={topic:t,payload:{identity:n}},h=new s((e=>`__OPENFIN__${e.uuid}_${e.name}`)(n));await h.acquired(),await new Promise(((e,r)=>{i.addEventListener(\"message\",(i=>{i.data.topic===o(t)&&(i.data.success?e():r(new Error(i.data.reason)))})),i.start?.(),i.postMessage(d,[c.port2])}));const l={topic:o(e),success:!0,payload:{identity:n}};return r.postMessage(l,\"*\",[a.port2,c.port1]),a.port1})(window.parent,c,n);d.start(),c.start?.(),l.log(`Port transfer complete in ${a.state} mode. Connection established with identity ${JSON.stringify(n)}. SharedWorker support=${a.isSharedWorkerSupported()}`)}catch(e){const t=new Error(`An unexpected error occured during initialization. ${e.message}`);p({reason:t.message}),console.error(t)}},exports.rejectConnections=p;\n","import type { Settings } from \"../shapes/setting-shapes\";\n\n/**\n * Fetches the settings for the application.\n * @returns The settings for the application.\n */\nexport async function getSettings(): Promise<Settings> {\n\treturn {\n\t\tplatform: {\n\t\t\tsharedWorkerUrl: \"http://localhost:6060/js/shared-worker.bundle.js\",\n\t\t\tbrokerUrl: \"http://localhost:6060/platform/iframe-broker.html\",\n\t\t\tproviderId: \"web-interop-basic\",\n\t\t\tdefaultContextGroup: \"green\"\n\t\t}\n\t};\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { init as initBrokerConnection } from \"@openfin/web-interop/iframe-broker\";\nimport { getSettings } from \"./settings\";\n\n/**\n * Initializes the OpenFin Web Broker connection.\n * @returns A promise that resolves when the connection is established.\n */\nasync function init(): Promise<void> {\n\tconst settings = await getSettings();\n\treturn initBrokerConnection({\n\t\tsharedWorkerUrl: settings.platform.sharedWorkerUrl,\n\t\texperimental: {\n\t\t\tcrossTab: \"same-site\"\n\t\t}\n\t});\n}\n\ninit()\n\t.then(() => {\n\t\tconsole.log(\"Connected to the OpenFin IFrame Web Broker.\");\n\t\treturn true;\n\t})\n\t.catch((err) => console.error(err));\n"],"names":[],"sourceRoot":""}